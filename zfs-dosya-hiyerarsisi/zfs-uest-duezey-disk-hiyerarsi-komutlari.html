
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>ZFS Üst Düzey Disk Hiyerarşi Komutları · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="ZFS'de üst düzey olarak nitelendirilebilecek hiyerarşi komutları.">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../zfsde-ek-oezellikler/zfs-havuz-yoenetimi-bazi-ek-oezellikler.html" />
    
    
    <link rel="prev" href="zfs-hiyerarshisi.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Giriş
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Başlangıç</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../baslangic/zfsnin-oezellikleri.html">
            
                <a href="../baslangic/zfsnin-oezellikleri.html">
            
                    
                    ZFS'nin Özellikleri
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../baslangic/zfsyi-anlamak.html">
            
                <a href="../baslangic/zfsyi-anlamak.html">
            
                    
                    ZFS'yi Anlamak
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../baslangic/zfsyi-gercek-ortamda-kullanmak.html">
            
                <a href="../baslangic/zfsyi-gercek-ortamda-kullanmak.html">
            
                    
                    ZFS'yi Çalışma Ortamına Kurmak
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">ZFS'ye Giriş</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../zfsye-giris/zfs-ye-giris.html">
            
                <a href="../zfsye-giris/zfs-ye-giris.html">
            
                    
                    ZFS'ye Giriş
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">ZFS Havuzu</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../zfs-havuzu/zfs-havuz-yoenetimi-basit-havuz-operasyonlari.html">
            
                <a href="../zfs-havuzu/zfs-havuz-yoenetimi-basit-havuz-operasyonlari.html">
            
                    
                    ZFS Havuz Yönetimi - Basit Havuz Operasyonları
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../zfs-havuzu/zfs-havuz-yoenetimi-detayli-havuz-yoenetimi.html">
            
                <a href="../zfs-havuzu/zfs-havuz-yoenetimi-detayli-havuz-yoenetimi.html">
            
                    
                    ZFS Havuz Yönetimi - Detaylı Havuz Yönetimi
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">ZFS Dosya Hiyerarşisi</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="zfs-hiyerarshisi.html">
            
                <a href="zfs-hiyerarshisi.html">
            
                    
                    ZFS Disk Hiyerarşisi
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="5.2" data-path="zfs-uest-duezey-disk-hiyerarsi-komutlari.html">
            
                <a href="zfs-uest-duezey-disk-hiyerarsi-komutlari.html">
            
                    
                    ZFS Üst Düzey Disk Hiyerarşi Komutları
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">ZFS'de Ek Özellikler</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="../zfsde-ek-oezellikler/zfs-havuz-yoenetimi-bazi-ek-oezellikler.html">
            
                <a href="../zfsde-ek-oezellikler/zfs-havuz-yoenetimi-bazi-ek-oezellikler.html">
            
                    
                    ZFS Havuz Yönetimi - Bazı Ek Havuz Yönetimi Komutları
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Gerçek Hayatta ZFS'nin Kullanımı</li>
        
        
    
        <li class="chapter " data-level="7.1" data-path="../gercek-hayatta-zfsnin-kullanimi/zfs-veri-kurtarma-senaryolari.html">
            
                <a href="../gercek-hayatta-zfsnin-kullanimi/zfs-veri-kurtarma-senaryolari.html">
            
                    
                    ZFS Veri Kurtarma Senaryoları
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">SON KISIM</li>
        
        
    
        <li class="chapter " data-level="8.1" data-path="../son-kisim/ekler/">
            
                <a href="../son-kisim/ekler/">
            
                    
                    Ekler
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.1.1" data-path="../son-kisim/ekler/sikca-sorulan-sorular.html">
            
                <a href="../son-kisim/ekler/sikca-sorulan-sorular.html">
            
                    
                    Sıkça Sorulan Sorular
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="../son-kisim/kaynakca.html">
            
                <a href="../son-kisim/kaynakca.html">
            
                    
                    Kaynakça
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.3" data-path="../son-kisim/lisans.html">
            
                <a href="../son-kisim/lisans.html">
            
                    
                    GNU Özgür Belgelendirme Lisansı
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >ZFS Üst Düzey Disk Hiyerarşi Komutları</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="zfs-&#xFC;st-d&#xFC;zey-disk-hiyerar&#x15F;i-komutlar&#x131;">ZFS &#xDC;st D&#xFC;zey Disk Hiyerar&#x15F;i Komutlar&#x131;</h1>
<h2 id="zfsye-has-hiyerar&#x15F;i-&#xF6;zellikleri">ZFS&apos;ye Has Hiyerar&#x15F;i &#xD6;zellikleri</h2>
<h3 id="zfsde-anl&#x131;k-g&#xF6;r&#xFC;nt&#xFC;-&#xF6;zelli&#x11F;i">ZFS&apos;de Anl&#x131;k G&#xF6;r&#xFC;nt&#xFC; &#xD6;zelli&#x11F;i</h3>
<p>ZFS&apos;de anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;ler (snapshot), Linux LVM anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;lerine benzemektedir. Anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;, birinci s&#x131;n&#x131;f salt okunur bir dosya sistemidir. Anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;y&#xFC; ald&#x131;&#x11F;&#x131;n&#x131;z andaki dosya sisteminin durumunun aynalanm&#x131;&#x15F; bir kopyas&#x131;d&#x131;r. Diskimizin o andaki verilerinin bir foto&#x11F;raf&#x131; gibidir. Disk verileri de&#x11F;i&#x15F;iyor olsa da, tam o foto&#x11F;raf&#x131; &#xE7;ekti&#x11F;iniz anda diskin neye benzedi&#x11F;ine dair bir imaj&#x131;m&#x131;z oldu&#x11F;u i&#xE7;in o ana geri d&#xF6;nerek verileri kurtarabiliriz. Sonu&#xE7; olarak veri k&#xFC;mesinin par&#xE7;as&#x131; olan veri de&#x11F;i&#x15F;iklikleri, orijinal kopyay&#x131; anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;n&#xFC;n kendisinde tutars&#x131;n&#x131;z. Bu &#x15F;ekilde, o dosya sisteminin kal&#x131;c&#x131;l&#x131;&#x11F;&#x131;n&#x131; koruyabilirsiniz.</p>
<p>Havuzunuzda 2^64&apos;e kadar anl&#x131;k g&#xF6;r&#xFC;nt&#xFC; tutabilirsiniz, ZFS anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;leri yeniden ba&#x15F;latma s&#x131;ras&#x131;nda kal&#x131;c&#x131;d&#x131;r ve herhangi bir ek yedekleme deposu gerektirmez; verilerinizin geri kalan&#x131;yla ayn&#x131; depolama havuzunu kullan&#x131;rlar. Bir ZFS anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;s&#xFC;, bu ZFS veri a&#x11F;ac&#x131;n&#x131;n bir kopyas&#x131;d&#x131;r, ancak bu veri a&#x11F;ac&#x131;n&#x131;n anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;s&#xFC;n&#xFC;n hi&#xE7;bir zaman de&#x11F;i&#x15F;tirilmedi&#x11F;inden imaj&#x131;n %100 sa&#x11F;lam oldu&#x11F;undan emin olabilirsiniz.</p>
<p>Anl&#x131;k g&#xF6;r&#xFC;nt&#xFC; olu&#x15F;turmak neredeyse anl&#x131;kt&#x131;r ve maaliyeti &#xE7;ok azd&#x131;r. Bununla birlikte, veriler de&#x11F;i&#x15F;meye ba&#x15F;lad&#x131;&#x11F;&#x131;nda, anl&#x131;k g&#xF6;r&#xFC;nt&#xFC; verileri depolamaya ba&#x15F;layacakt&#x131;r. Birden fazla anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;n&#xFC;z varsa, t&#xFC;m anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;lerde birden &#xE7;ok delta izlenmektedir. Yani git&apos;e ait commit yap&#x131;s&#x131;ndan farkl&#x131; olarak het g&#xF6;r&#xFC;nt&#xFC; kendi deltalar&#x131;na sahiptir</p>
<h4 id="anl&#x131;k-g&#xF6;r&#xFC;nt&#xFC;-olu&#x15F;turma">Anl&#x131;k G&#xF6;r&#xFC;nt&#xFC; Olu&#x15F;turma</h4>
<p>&#x130;ki t&#xFC;r anl&#x131;k g&#xF6;r&#xFC;nt&#xFC; olu&#x15F;turabilirsiniz: havuz anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;leri ve veri k&#xFC;mesi anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;leri. Hangi t&#xFC;r anl&#x131;k g&#xF6;r&#xFC;nt&#xFC; almak istedi&#x11F;iniz size kalm&#x131;&#x15F;. Ancak anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;ye bir ad vermelisiniz. Anl&#x131;k g&#xF6;r&#xFC;nt&#xFC; ad&#x131;n&#x131;n s&#xF6;zdizimi &#x15F;&#xF6;yledir:</p>
<pre><code>havuz/veri k&#xFC;mesi@anl&#x131;k_g&#xF6;r&#xFC;nt&#xFC;-ad&#x131;
havuz@anl&#x131;k_g&#xF6;r&#xFC;nt&#xFC;-ad&#x131;
</code></pre><p>Bir anl&#x131;k g&#xF6;r&#xFC;nt&#xFC; olu&#x15F;turmak i&#xE7;in &quot;zfs snapshot&quot; komutunu kullan&#x131;yoruz. &#xD6;rne&#x11F;in, &quot;tank/deneme&quot; veri k&#xFC;mesinin anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;s&#xFC;n&#xFC; almak i&#xE7;in &#x15F;unlar&#x131; &#xE7;&#x131;kar&#x131;r&#x131;z:</p>
<pre><code>~# zfs snapshot tank/test@20210403
</code></pre><p>Anl&#x131;k g&#xF6;r&#xFC;nt&#xFC; birinci s&#x131;n&#x131;f bir dosya sistemi olsa da, standart ZFS veri k&#xFC;meleri veya havuzlar gibi de&#x11F;i&#x15F;tirilebilir &#xF6;zellikler i&#xE7;ermez. Asl&#x131;nda, anl&#x131;k g&#xF6;r&#xFC;nt&#xFC; hakk&#x131;ndaki her &#x15F;ey salt okunurdur. &#xD6;rne&#x11F;in, bir anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;de s&#x131;k&#x131;&#x15F;t&#x131;rmay&#x131; etkinle&#x15F;tirmek isterseniz, &#x15F;u &#x15F;ekilde olur:</p>
<pre><code># zfs set compression=lzma tank/test@20210403
cannot set property for &apos;tank/test@20210403&apos;: this property can not be modified for snapshots
</code></pre><h4 id="anl&#x131;k-g&#xF6;r&#xFC;nt&#xFC;leri-listeleme">Anl&#x131;k G&#xF6;r&#xFC;nt&#xFC;leri Listeleme</h4>
<p>Anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;ler iki &#x15F;ekilde g&#xF6;r&#xFC;nt&#xFC;lenebilir: veri k&#xFC;mesinin k&#xF6;k dizininde yer alan gizli &quot;.zfs&quot; dizinine eri&#x15F;erek veya &quot;zfs list&quot; komutunu kullanarak g&#xF6;r&#xFC;nt&#xFC;leyebiliriz. </p>
<pre><code>~# ls -a /tank/test
./ ../ boot.tar text.tar text.tar.2
~# cd /tank/test/.zfs/
~# ls -a
./  ../  shares/  snapshot/
</code></pre><p>Varsay&#x131;lan zfs detay dizini gizlidir. Ancak ZFS&apos;deki her &#x15F;ey gibi bunu da de&#x11F;i&#x15F;tirebiliriz:</p>
<pre><code># zfs set snapdir=visible tank/test
# ls -a /tank/test
./  ../  zfs/
</code></pre><p>Anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;leri g&#xF6;r&#xFC;nt&#xFC;lemenin di&#x11F;er yolu,  &quot;-t anl&#x131;k snapshot&quot; parametresi ile &quot;zfs list&quot; komutunu kullanmakt&#x131;r:</p>
<pre><code># zfs list -t snapshot
NAME                       USED  AVAIL  REFER  MOUNTPOINT
tank/test@20210403            0      -   525M  -
</code></pre><p>Bende bir tane ayg&#x131;t havuzu ve bir tane snaphot oldu&#x11F;una dikkat &#xE7;ekerim. Varsay&#x131;lan olarak, t&#xFC;m havuzlar i&#xE7;in t&#xFC;m anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;leri zfs list komutu ile g&#xF6;sterilmektedir.</p>
<p>&#xC7;&#x131;kt&#x131;yla daha spesifik olmak istiyorsan&#x131;z, ister veri k&#xFC;mesi ister depolama havuzu olsun, belirli bir k&#xF6;k sistemin t&#xFC;m anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;lerini g&#xF6;rebilirsiniz. &#xD6;zyineleme i&#xE7;in yaln&#x131;zca &quot;-r&quot; parametresini kullanmam&#x131;z ve ard&#x131;ndan k&#xF6;k sistemi sa&#x11F;laman&#x131;z gerekir. Bu durumda, yaln&#x131;zca depolama havuzu &quot;tank&quot; &#x131;n anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;lerini g&#xF6;rece&#x11F;im ve di&#x11F;er havuzlar&#x131;n i&#xE7;indekileri g&#xF6;z ard&#x131; edece&#x11F;im:</p>
<pre><code>~# zpool create tank2
~# zfs snapshot tank2@firstcreated
~# zpool create tank3
~# zfs snapshot tank3@firstcreated
# zfs list -t snapshot
NAME                       USED  AVAIL  REFER  MOUNTPOINT
tank/test@20210403            0      -   525M  -
tank2@firstcreated            0      -   1M    -
tank2@firstcreated            0      -   1M    -
~# zfs list -r -t snapshot tank
NAME                       USED  AVAIL  REFER  MOUNTPOINT
tank/test@20210403            0      -   525M  -
</code></pre><h4 id="anl&#x131;k-g&#xF6;r&#xFC;nt&#xFC;leri-yok-etme">Anl&#x131;k G&#xF6;r&#xFC;nt&#xFC;leri Yok Etme</h4>
<p>Bir depolama havuzunu veya bir ZFS veri k&#xFC;mesini yok edece&#x11F;iniz gibi, anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;leri yok etmek i&#xE7;in benzer bir y&#xF6;ntem kullan&#x131;r&#x131;z. Bir anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;y&#xFC; yok etmek i&#xE7;in, &quot;zfs destroy&quot; komutunu kullan&#x131;r&#x131;z, bu komuta parametre olarak yok etmek istedi&#x11F;iniz anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;y&#xFC; vererek anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;leri yok edebiliriz:</p>
<pre><code>~# zfs destroy tank/test@20210403
</code></pre><p>Bilinmesi gereken &#xF6;nemli bir nokta, bir anl&#x131;k g&#xF6;r&#xFC;nt&#xFC; varsa, veri k&#xFC;mesinin alt dosya sistemi olarak kabul edilmektedir. Bu nedenle, t&#xFC;m anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;ler ve i&#xE7; i&#xE7;e ge&#xE7;mi&#x15F; veri k&#xFC;meleri yok edilene kadar bir veri k&#xFC;mesini kald&#x131;ramazs&#x131;n&#x131;z.</p>
<pre><code>~# zfs destroy tank/test 
cannot destroy &apos;tank/test&apos;: filesystem has children
use &apos;-r&apos; to destroy the following datasets:
tank/test@20210403
</code></pre><p>Anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;leri yok etmek, di&#x11F;er anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;lerin tuttu&#x11F;u ek alan&#x131; bo&#x15F;altabilir, ana disk alan&#x131;na etkisi hi&#xE7; omlayacak veya &#xE7;ok az olacakt&#x131;r &#xE7;&#xFC;nk&#xFC; bunlar bu alan anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;lere &#xF6;zg&#xFC; bir aland&#x131;r.</p>
<h4 id="anl&#x131;k-g&#xF6;r&#xFC;nt&#xFC;leri-yeniden-adland&#x131;rma">Anl&#x131;k G&#xF6;r&#xFC;nt&#xFC;leri Yeniden Adland&#x131;rma</h4>
<p>Anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;leri yeniden adland&#x131;rabilirsiniz, ancak olu&#x15F;turulduklar&#x131; depolama havuzunda ve ZFS veri k&#xFC;mesinde yeniden adland&#x131;r&#x131;lmalar&#x131; gerekir. Bunun d&#x131;&#x15F;&#x131;nda, anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;leri yeniden adland&#x131;rmak disk hiyerar&#x15F;isi veya havuzu yeniden adland&#x131;rmak kadar basittir:</p>
<pre><code># zfs rename tank/test@20210403 tank/test@2021-mart-carsamba
</code></pre><h4 id="anl&#x131;k-g&#xF6;r&#xFC;nt&#xFC;ye-geri-d&#xF6;nme">Anl&#x131;k G&#xF6;r&#xFC;nt&#xFC;ye Geri D&#xF6;nme</h4>
<p>&#xD6;nceki bir anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;ye geri d&#xF6;nmek, bu anl&#x131;k g&#xF6;r&#xFC;nt&#xFC; ile ge&#xE7;erli saat aras&#x131;ndaki t&#xFC;m veri de&#x11F;i&#x15F;ikliklerini temizleyecektir. Ayr&#x131;ca, varsay&#x131;lan olarak, yaln&#x131;zca en son anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;ye geri d&#xF6;nebilirsiniz. Daha &#xF6;nceki bir anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;ye geri d&#xF6;nmek i&#xE7;in, ge&#xE7;erli saat ile geri d&#xF6;nmek istedi&#x11F;iniz anl&#x131;k g&#xF6;r&#xFC;nt&#xFC; aras&#x131;ndaki t&#xFC;m anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;leri yok etmeniz anlam&#x131;na gelmektedir. ZFS&apos;de tek kesinti ya&#x15F;ayabilece&#x11F;imiz an geriye d&#xF6;nme i&#x15F;lemidir. </p>
<p><code>zfs rollback</code> komutu ile bu i&#x15F;lem yap&#x131;lmaktad&#x131;r.</p>
<pre><code>~# zfs rollback tank/test@20210403
</code></pre><p>E&#x11F;er bu anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;lerden sonra al&#x131;nm&#x131;&#x15F; ba&#x15F;ka anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;ler varsa bu i&#x15F;lem yap&#x131;lmayacakt&#x131;r.</p>
<pre><code># zfs rollback tank/test@20210403
cannot rollback to &apos;tank/test@20210403&apos;: more recent snapshots exist
use &apos;-r&apos; to force deletion of the following snapshots:
tank/test@20210404
tank/test@20210405
</code></pre><h4 id="zfs-klonlar&#x131;">ZFS Klonlar&#x131;</h4>
<p>Bir ZFS klonu, anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;lerden t&#xFC;retilmi&#x15F; veya bir nevi &quot;y&#xFC;kseltilmi&#x15F;&quot; yaz&#x131;labilir bir dosya sistemidir. Klonlar yaln&#x131;zca anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;lerden olu&#x15F;turulabilir ve anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;ye ba&#x11F;&#x131;ml&#x131;d&#x131;r ve bu klonlar, klon var oldu&#x11F;u s&#xFC;rece kal&#x131;r. Bu, bir anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;y&#xFC; klonlad&#x131;ysan&#x131;z yok edemeyece&#x11F;iniz anlam&#x131;na gelir. Klon, anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;n&#xFC;n verdi&#x11F;i verilere dayan&#x131;r. Anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;y&#xFC; yok etmeden &#xF6;nce klonu yok etmelisiniz.</p>
<p>Klonlar olu&#x15F;turmak, t&#x131;pk&#x131; anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;ler gibi neredeyse anl&#x131;kt&#x131;r ve ba&#x15F;lang&#x131;&#xE7;ta herhangi bir ek yer kaplamaz. Klonlar&#x131;n aksine, anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;n&#xFC;n t&#xFC;m ba&#x15F;lang&#x131;&#xE7; &#x200B;&#x200B;alan&#x131;n&#x131; kaplar. Veriler klonda de&#x11F;i&#x15F;tirildik&#xE7;e, anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;den ayr&#x131; bir yer kaplamaya ba&#x15F;lar.</p>
<h4 id="zfs-klonlar&#x131;-olu&#x15F;turma">ZFS Klonlar&#x131; Olu&#x15F;turma</h4>
<p>Bir klon olu&#x15F;turma, &quot;zfs klonu&quot; komutu, klonlanacak anl&#x131;k g&#xF6;r&#xFC;nt&#xFC; ve yeni dosya sisteminin ad&#x131; ile yap&#x131;l&#x131;r. Klonun, klonla ayn&#x131; veri k&#xFC;mesinde bulunmas&#x131; gerekmez, ancak ayn&#x131; depolama havuzunda bulunmas&#x131; gerekir. &#xD6;rne&#x11F;in, &quot;tank/test@20210403&quot; anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;s&#xFC;n&#xFC; klonlamak ve ona &quot;tank/klon1&quot; ad&#x131;n&#x131; vermek istersem, a&#x15F;a&#x11F;&#x131;daki &#x15F;ekilde bunu yapabilirim:</p>
<pre><code>~# zfs clone tank/test@20210403 tank/klon1
~# zfs list -r tank
NAME           USED   AVAIL  REFER  MOUNTPOINT
tank           161M   2.78G  44.9K  /tank
tank/test      37.1M  2.78G  37.1M  /tank/test
tank/klon1     37.1M  2.78G  37.1M  /tank/klon1
</code></pre><p>Klonlarla alakal&#x131; bir durum da onlar&#x131; hiyerar&#x15F;i gibi kullan&#x131;yor olmam&#x131;zd&#x131;r. Ancak unutmay&#x131;n ki bu bizim dosya havuzumuzdaki alandan yemektedir.</p>
<h4 id="klonlar&#x131;-yok-etmek">Klonlar&#x131; Yok Etmek</h4>
<p>Veri k&#xFC;melerini ve tabi ki anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;leri yok ederken oldu&#x11F;u gibi, &quot;zfs destory&quot; komutunu kullan&#x131;yoruz. Yine, klonlar&#x131; yok edene kadar bir anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;y&#xFC; yok edemezsiniz. Ayr&#x131;ca bir g&#xF6;r&#xFC;nt&#xFC; bir klona ba&#x11F;l&#x131;ysa yine ba&#x15F;ta bu klonu yok etmeden g&#xF6;r&#xFC;nt&#xFC;y&#xFC; yok edemezsiniz.</p>
<pre><code>~# zfs destroy tank/klon1
</code></pre><h3 id="hiyerar&#x15F;i-baz&#x131;nda-s&#x131;k&#x131;&#x15F;t&#x131;rma-ayarlamak">Hiyerar&#x15F;i Baz&#x131;nda S&#x131;k&#x131;&#x15F;t&#x131;rma Ayarlamak</h3>
<p>E&#x11F;er etkinle&#x15F;tirirseniz, ZFS hiyerar&#x15F;ileri, ayr&#x131; ayr&#x131; s&#x131;k&#x131;&#x15F;t&#x131;rmay&#x131; destekler ve bu i&#x15F;lemde veriler &#x15F;effaf bir &#x15F;ekilde tutulur. Havuzunuzda saklad&#x131;&#x11F;&#x131;n&#x131;z her dosya s&#x131;k&#x131;&#x15F;t&#x131;r&#x131;labilir. Kullan&#x131;c&#x131; ise bu s&#x131;k&#x131;&#x15F;t&#x131;r&#x131;lm&#x131;&#x15F; dosyalara hi&#xE7; s&#x131;k&#x131;&#x15F;t&#x131;r&#x131;lmam&#x131;&#x15F;&#xE7;as&#x131;na eri&#x15F;ilebilir. Ba&#x15F;ka bir deyi&#x15F;le, geleneksel dosya sistemine ba&#x11F;land&#x131;&#x11F;&#x131; andan itibaren hiyerar&#x15F;iler kullan&#x131;c&#x131;n&#x131;n ek bir i&#x15F;lem yapmas&#x131;na gerek kalmadan s&#x131;k&#x131;&#x15F;t&#x131;r&#x131;lmas&#x131;n&#x131; ve kullan&#x131;ld&#x131;&#x11F;&#x131; zaman a&#xE7;&#x131;larak kullan&#x131;lmas&#x131;n&#x131; sa&#x11F;lar. ZFS geleneksel s&#x131;k&#x131;&#x15F;t&#x131;rma y&#xF6;ntemlerinin aksine, dosya katman&#x131;n&#x131;n alt&#x131;nda, diskteki veriler an&#x131;nda s&#x131;k&#x131;&#x15F;t&#x131;r&#x131;l&#x131;r veya a&#xE7;&#x131;l&#x131;r. Ve CPU&apos;da s&#x131;k&#x131;&#x15F;t&#x131;rma yapman&#x131;n maliyeti az oldu&#x11F;u ve baz&#x131; algoritmalarda s&#x131;k&#x131;&#x15F;t&#x131;rma son derece h&#x131;zl&#x131; oldu&#x11F;u i&#xE7;in kullan&#x131;c&#x131; taraf&#x131;ndan &#xE7;o&#x11F;unlukla farkedilmemektedir.</p>
<p>Daha &#xF6;ncesinde aktard&#x131;&#x11F;&#x131;m gibi hiyerar&#x15F;iler i&#xE7;erisindeki veri k&#xFC;meleri ayr&#x131; ayr&#x131; s&#x131;k&#x131;&#x15F;t&#x131;rma ayarlamas&#x131;na sahiptir. &#x130;stenilene s&#x131;k&#x131;&#x15F;t&#x131;rma eklenebilir istenilenden de bu s&#x131;k&#x131;&#x15F;t&#x131;rma &#xF6;zelli&#x11F;i devre d&#x131;&#x15F;&#x131; b&#x131;rak&#x131;labilir. Ayr&#x131;ca desteklenen s&#x131;k&#x131;&#x15F;t&#x131;rma algoritmalar&#x131; LZJB , LZ4, ZLE ve Gzip&apos;tir. Son d&#xF6;nemde yap&#x131;lan g&#xFC;ncellemelerle ZSTD algoritmas&#x131; da &#xF6;ntan&#x131;ml&#x131; s&#x131;k&#x131;&#x15F;t&#x131;rmalar aras&#x131;na eklenmi&#x15F;tir.</p>
<p> Gzipte, 9 katmal&#x131; s&#x131;k&#x131;&#x15F;t&#x131;rma vard&#x131;r; 1. seviye olabildi&#x11F;ince h&#x131;zl&#x131;, en az s&#x131;k&#x131;&#x15F;t&#x131;rmayla ve 9. seviye olabildi&#x11F;ince s&#x131;k&#x131;&#x15F;t&#x131;rma yap&#x131;larak 1&apos;den 9&apos;a kadar olan standart d&#xFC;zeyleri belirlemeye imkan sa&#x11F;lar. Varsay&#x131;lan, GNU/Linux ve di&#x11F;er Unix i&#x15F;letim sistemlerinde standart oldu&#x11F;u gibi 6&apos;d&#x131;r. </p>
<p>LZJB ise ZFS&apos;nin de yazar&#x131; olan Jeff Bonwick taraf&#x131;ndan icat edilen bir s&#x131;k&#x131;&#x15F;t&#x131;rma algoritmas&#x131;d&#x131;r. LZJB, &#xE7;o&#x11F;u Lempel-Ziv algoritmas&#x131;nda standart olan s&#x131;k&#x131; s&#x131;k&#x131;&#x15F;t&#x131;rma oranlar&#x131; ile h&#x131;zl&#x131; olacak &#x15F;ekilde tasarlanm&#x131;&#x15F;t&#x131;r. LZJB varsay&#x131;land&#x131;r. ZLE, &#xE7;ok hafif s&#x131;k&#x131;&#x15F;t&#x131;rma oranlar&#x131;na sahip bir h&#x131;z canavar&#x131;d&#x131;r. LZJB, performans ve s&#x131;k&#x131;&#x15F;t&#x131;rma a&#xE7;&#x131;s&#x131;ndan en iyi sonu&#xE7;lar&#x131; sa&#x11F;l&#x131;yor gibi g&#xF6;r&#xFC;n&#xFC;yor.</p>
<p>Son d&#xF6;nemlerde pek&#xE7;ok da&#x11F;&#x131;t&#x131;m&#x131;n ve paket y&#xF6;netim sisteminin g&#xF6;&#xE7; etti&#x11F;i ZSTD ise bize GZIP kadar iyi s&#x131;k&#x131;&#x15F;t&#x131;rma deste&#x11F;i verirken CPU a&#xE7;&#x131;s&#x131;ndan daha az maliyetli hesaplamay&#x131; desteklemektedir. Bu a&#xE7;&#x131;dan bak&#x131;ld&#x131;&#x11F;&#x131;nda performans olarak en az LZJB kadar iyi sonu&#xE7;lar sa&#x11F;lamaktad&#x131;r.</p>
<p><strong>NOT:</strong> Bir veri k&#xFC;mesinde s&#x131;k&#x131;&#x15F;t&#x131;rman&#x131;n etkinle&#x15F;tirilmesi geriye d&#xF6;n&#xFC;k olarak verilerin s&#x131;k&#x131;&#x15F;t&#x131;r&#x131;laca&#x11F;&#x131; anlam&#x131;na gelmez! Yaln&#x131;zca yeni kaydedilmi&#x15F; veya de&#x11F;i&#x15F;tirilmi&#x15F; veriler i&#xE7;in ge&#xE7;erli olacak &#x15F;ekilde verileri s&#x131;k&#x131;&#x15F;t&#x131;racakt&#x131;r. Veri k&#xFC;mesindeki &#xF6;nceki veriler s&#x131;k&#x131;&#x15F;t&#x131;r&#x131;lmam&#x131;&#x15F; olarak kalacakt&#x131;r. Bu nedenle, s&#x131;k&#x131;&#x15F;t&#x131;rmay&#x131; kullanmak istiyorsan&#x131;z, verileri i&#x15F;lemeye ba&#x15F;lamadan &#xF6;nce etkinle&#x15F;tirmelisiniz.</p>
<p>ZFS hiyerar&#x15F;ilerinde veri k&#xFC;mesinin s&#x131;k&#x131;&#x15F;t&#x131;rma &#xF6;zelli&#x11F;i <code>compression</code> parametresi ile ayarlanmaktad&#x131;r. Bu parametre s&#x131;k&#x131;&#x15F;t&#x131;rma algoritmas&#x131;n&#x131;n tipini parametre olarak almaktad&#x131;r.</p>
<pre><code class="lang-text">~# zpool list
NAME   SIZE  ALLOC   FREE  CKPOINT  EXPANDSZ   FRAG    CAP  DEDUP    HEALTH  ALTROOT
tank  11.2G   230K  11.2G        -         -     0%     0%  1.00x    ONLINE  -
~# zfs create tank/deneme
~# zfs set compression=lz4 tank/deneme
~# zfs list
NAME          USED  AVAIL     REFER  MOUNTPOINT
tank          261K  10.9G     25.5K  /tank
tank/deneme    24K  10.9G       24K  /tank/deneme
</code></pre>
<p>&#x15E;imdi boyutu belirli bir boyutu kullanarak <strong><code>urandom</code></strong> ile elde edilmi&#x15F; dosyay&#x131; k&#xF6;k dizine yazal&#x131;m.</p>
<pre><code class="lang-text">~# dd bs=1024 count=100000 &lt; /dev/urandom &gt; dosya
100000+0 kay&#x131;t girdi
100000+0 kay&#x131;t &#xE7;&#x131;kt&#x131;
102400000 bytes (102 MB, 98 MiB) copied, 0,651381 s, 157 MB/s
~# ls -lh dosya
-rw-r--r--. 1 root root 100M Mar  3 13:15 dosya
</code></pre>
<p>&#x15E;imdi bu dosyay&#x131; <strong><code>/tank/deneme</code></strong> yoluna ya&#x15F;&#x131;yal&#x131;m.</p>
<pre><code class="lang-text">~# mv dosya /tank/deneme
~# ls -lh /tank/deneme/
toplam 98M
-rw-r--r--. 1 root root 98M Mar  3 13:15 dosya
</code></pre>
<p>G&#xF6;rd&#xFC;&#x11F;&#xFC;m&#xFC;z gibi 2 MB kadar&#x131; s&#x131;k&#x131;&#x15F;t&#x131;rmadan kazan&#x131;ld&#x131;. &#x15E;imdi s&#x131;k&#x131;&#x15F;t&#x131;rma oran&#x131;n&#x131; inceleyelim.</p>
<pre><code class="lang-text">~# zfs get compressratio tank/deneme
NAME         PROPERTY       VALUE  SOURCE
tank/deneme  compressratio  2.14x  -
</code></pre>
<h3 id="hiyerar&#x15F;ileri-tekille&#x15F;tirme">Hiyerar&#x15F;ileri Tekille&#x15F;tirme</h3>
<p>Hiyerar&#x15F;ilerde en optimum &#x15F;ekilde alan&#x131; kullanmak ve alandandan tasarruf etmek i&#xE7;in s&#x131;k&#x131;&#x15F;t&#x131;rma haricinde ba&#x15F;ka bir yol daha vard&#x131;r. Buna tekille&#x15F;tirme ismi verilir. &#xDC;&#xE7; ana veri tekille&#x15F;tirme t&#xFC;r&#xFC; vard&#x131;r: dosya tekelle&#x15F;tirme, blok tekelle&#x15F;tirme ve bayt tekelle&#x15F;tirmedir. </p>
<p>Dosya tekille&#x15F;tirme, sistem kaynaklar&#x131; baz&#x131;nda en y&#xFC;ksek performansl&#x131; ve en az maliyetli olan&#x131;d&#x131;r. Her dosyaya SHA-256 gibi bir karma algoritmas&#x131; uygulan&#x131;r. Karma birden &#xE7;ok dosya i&#xE7;in e&#x15F;le&#x15F;irse, yeni dosyay&#x131; diskte depolamak yerine, meta verilerde depolar ve orijinal verilere ba&#x15F;vurmak i&#xE7;in bu dosyaya ba&#x15F;vururuz. Dosya tekille&#x15F;tirme &#xF6;zellikle i&#xE7;erisindeki verileri s&#x131;k&#xE7;a tekrarlanan dosyalar&#x131; depolarken &#xF6;nemli boyut tasarruflar sa&#x11F;layabilir, ancak ciddi bir dezavantaj&#x131; vard&#x131;r. Dosyada tek bir bayt de&#x11F;i&#x15F;irse, karmalar art&#x131;k e&#x15F;le&#x15F;meyecektir, art&#x131;k dosya sistemi meta verilerindeki t&#xFC;m dosyaya referans veremeyece&#x11F;imiz anlam&#x131;na gelir. Referanslar&#x131; kaybedilen veriler tamamen kaybolma riskine sahiptir. Bu nedenle, t&#xFC;m bloklar&#x131;n bir kopyalar&#x131;n&#x131; olu&#x15F;turmam&#x131;z ve yedekli olarak &#xE7;al&#x131;&#x15F;mam&#x131;z gerekir. Ayr&#x131;ca, b&#xFC;y&#xFC;k dosyalar i&#xE7;in tekelle&#x15F;tirme performans&#x131; negatif olarak etkileyecektir.</p>
<p>Bir di&#x11F;er tekelle&#x15F;tirme t&#xFC;r&#xFC; ise, bayt tekille&#x15F;tirmedir. Bu tekille&#x15F;tirme y&#xF6;ntemi en maliyetli y&#xF6;ntemdir, &#xE7;&#xFC;nk&#xFC; tekille&#x15F;tirilmi&#x15F; ve benzersiz bayt b&#xF6;lgelerinin nerede ba&#x15F;lay&#x131;p bitece&#x11F;ini belirlemek i&#xE7;in &quot;ba&#x11F;lant&#x131; noktalar&#x131;n&#x131;&quot; tutman&#x131;z gerekir. Sonu&#xE7;ta, baytlar baytt&#x131;r ve hangi dosyalar&#x131;n onlara ihtiyac&#x131; oldu&#x11F;unu bilmemek demek, bir dosyay&#x131; bulmak i&#xE7;in samanl&#x131;kta i&#x11F;ne aramak demektir. Bu t&#xFC;r bir tekille&#x15F;tirme, bir dosyan&#x131;n birden &#xE7;ok kez depolanabildi&#x11F;i depolamada i&#x15F;e yarar.</p>
<p>Bir di&#x11F;er tekelle&#x15F;tirme y&#xF6;ntemi olarak da blok tekille&#x15F;tirme var. ZFS yaln&#x131;zca blok tekille&#x15F;tirmeyi kullan&#x131;r. Blok tekille&#x15F;tirme, farkl&#x131; olan bloklar hari&#xE7;, bir dosyadaki t&#xFC;m ayn&#x131; bloklar&#x131; payla&#x15F;&#x131;r. Bu, yaln&#x131;zca benzersiz bloklar&#x131; diskte depolamam&#x131;za ve RAM&apos;de payla&#x15F;&#x131;lan bloklara ba&#x15F;vurmam&#x131;za izin verir. Bayt tekille&#x15F;tirmeden daha verimli ve dosya tekille&#x15F;tirmeden daha esnektir. Bununla birlikte, bir dezavantaj&#x131; vard&#x131;r, hangi bloklar&#x131;n payla&#x15F;&#x131;ld&#x131;&#x11F;&#x131;n&#x131; ve hangilerinin payla&#x15F;&#x131;lmad&#x131;&#x11F;&#x131;n&#x131; takip etmek i&#xE7;in b&#xFC;y&#xFC;k miktarda bellek kullan&#x131;m&#x131; gerektirir. Bununla birlikte, dosya sistemleri verileri blok segmentlerinde okuyup yaz&#x131;ld&#x131;&#x11F;&#x131;ndan, modern bir dosya sistemi i&#xE7;in blok tekille&#x15F;tirmeyi kullanmak en mant&#x131;kl&#x131; olan&#x131;d&#x131;r.</p>
<p>Payla&#x15F;&#x131;lan bloklar, &quot;tekille&#x15F;tirme tablosu&quot; ad&#x131; verilen b&#xF6;l&#xFC;mde saklan&#x131;r. Dosya sisteminde ne kadar &#xE7;ok kopyalanm&#x131;&#x15F; blok varsa, bu tablo o kadar b&#xFC;y&#xFC;r. Veriler her yaz&#x131;ld&#x131;&#x11F;&#x131;nda veya okundu&#x11F;unda, tekille&#x15F;tirme tablosuna ba&#x15F;vurulur. Bu, t&#xFC;m tekille&#x15F;tirme tablosunun RAM&apos;de tutmam&#x131;z gerekti&#x11F;i anlam&#x131;na gelir. Yeterli RAM&apos;e sahip de&#x11F;ilseniz, tablo diske ta&#x15F;acakt&#x131;r ve bu, hem veri okuma hem de yazma a&#xE7;&#x131;s&#x131;ndan depolama alan&#x131;n&#x131;zda b&#xFC;y&#xFC;k performans etkileri olabilir.</p>
<h4 id="tekille&#x15F;tirmenin-maliyeti">Tekille&#x15F;tirmenin Maliyeti</h4>
<p>Tekille&#x15F;tirmede RAM kulland&#x131;&#x11F;&#x131;m&#x131;z i&#xE7;in ak&#x131;llar&#x131;m&#x131;za gelen soru &#x15F;u: Tekille&#x15F;tirme tablonuzu depolamak i&#xE7;in ne kadar RAM&apos;e ihtiyac&#x131;n&#x131;z var? Bu sorunun kolay bir cevab&#x131; yok. Birincisi tekille&#x15F;tirme tablomuz, depolama havuzunuzdaki blok say&#x131;s&#x131; tekelle&#x15F;tirme tablosunu olu&#x15F;turmak i&#xE7;in esas al&#x131;n&#x131;r. Bu sebeple ne kadar &#xE7;ok blok gerekirse o kadar b&#xFC;y&#xFC;k bir tekelle&#x15F;tirme tablosu gerekecek dolay&#x131;s&#x131; ile daha &#xE7;ok RAM gerekecektir. </p>
<p>Blok bilgilerini <code>zdb</code> komutu ile &#xF6;&#x11F;renebiliriz. </p>
<pre><code class="lang-text">~# zdb -b tank
Traversing all blocks to verify nothing leaked ...

loading concrete vdev 3, metaslab 14 of 15 ...

        No leaks (block sum matches space maps exactly)

        bp count:                   916
        ganged count:                 0
        bp logical:           109821952      avg: 119892
        bp physical:          102536192      avg: 111939     compression:   1.07
        bp allocated:         102746624      avg: 112168     compression:   1.07
        bp deduped:                   0    ref&gt;1:      0   deduplication:   1.00
        Normal class:            187392     used:  0.00%

        additional, non-pointer bps of type 0:         48
        Dittoed blocks on same vdev: 5
        indirect vdev id 0 has 4 segments (4 in memory)
</code></pre>
<p>Bu durumda, depolama havuzumuz i&#xE7;erisinde 916 kullan&#x131;lm&#x131;&#x15F; blok vard&#x131;r (&quot;bp count&quot; say&#x131;s&#x131;). </p>
<p>Havuzdaki her tekille&#x15F;tirilmi&#x15F; blok i&#xE7;in yakla&#x15F;&#x131;k 320 bayt RAM gerektirir. Dolay&#x131;s&#x131;yla, blok ba&#x15F;&#x131;na 320 bayt ile &#xE7;arp&#x131;lan 916 blok i&#xE7;in bize yakla&#x15F;&#x131;k 0.2 MB RAM gerekmekte. Toplamda 10 GB i&#xE7;in 100 milyon blo&#x11F;a sahip oldu&#x11F;umuzu varsayarsak bu bizim 1.3MB tekelle&#x15F;tirme tablosuna ihtiyac&#x131;m&#x131;z vard&#x131;r. Bu, her 1 GB dosya sistemi i&#xE7;in 3,1 MB tekille&#x15F;tirme tablosu, 1 TB disk ba&#x15F;&#x131;na 3,12 GB tekelle&#x15F;tirme tablosu ihtiyac&#x131; anlam&#x131;na gelmektedir yan&#x131; 1TB diski tekille&#x15F;tirdikten sonra bizim 3.12 GB boyutunda RAM kullanmam&#x131;z gerekmektedir.</p>
<p>Depolaman&#x131;z&#x131; &#xF6;nceden planl&#x131;yorsan&#x131;z ve verileri i&#x15F;lemeden &#xF6;nce boyutunu bilmek istiyorsan&#x131;z, ortalama blok boyutunuzun ne olaca&#x11F;&#x131;n&#x131; bulman&#x131;z gerekir.<br>Bu durumda, verilere yak&#x131;ndan a&#x15F;ina olman&#x131;z gerekir. ZFS, verileri 128 KB&apos;lik bloklar halinde okur ve yazar. Ancak, &#xE7;ok say&#x131;da yap&#x131;land&#x131;rma dosyas&#x131;, ana dizin vb. depoluyorsan&#x131;z, dosyalar&#x131;n&#x131;z 128 KB&apos;tan k&#xFC;&#xE7;&#xFC;k olacakt&#x131;r. Bu &#xF6;rnek i&#xE7;in, yukar&#x131;daki &#xF6;rne&#x11F;imizde oldu&#x11F;u gibi ortalama blok boyutunun 100 KB olaca&#x11F;&#x131;n&#x131; varsayal&#x131;m. Toplam depolama alan&#x131;m 1 TB boyutundaysa, blok ba&#x15F;&#x131;na 100 KB&apos;ye b&#xF6;l&#xFC;nen 1 TB yakla&#x15F;&#x131;k 10 milyon blok demektir. Blok ba&#x15F;&#x131;na 320 bayt ile &#xE7;arp&#x131;ld&#x131;&#x11F;&#x131;nda, elimizdeki verileri tekille&#x15F;tirmek i&#xE7;in 3.2 GB RAM kullanmam&#x131;z gerekiyor.</p>
<p>Sonu&#xE7;ta her ihtimali g&#xF6;z &#xF6;n&#xFC;nde tutarak, her 1 TB disk i&#xE7;in 5 GB RAM ihtiyac&#x131;m&#x131;z olaca&#x11F;&#x131;n&#x131; varsaymak mant&#x131;kl&#x131; olacakt&#x131;r. Bu durum maliyet a&#xE7;&#x131;s&#x131;ndan olduk&#xE7;a sorunlu gibi dursa da, disk &#xFC;zerinde, ciddi performans etkilerine sahiptir.</p>
<h4 id="toplam-tekille&#x15F;tirmenin-ram-maliyeti">Toplam Tekille&#x15F;tirmenin Ram Maliyeti</h4>
<p>ZFS, RAM&apos;de veri tekille&#x15F;tirme tablosundan daha fazlas&#x131;n&#x131; depolar. Ayr&#x131;ca ARC&apos;yi ve di&#x11F;er ZFS meta verilerini de depolar. Ve tahmin edin bu durum nelere sebep olabilir?</p>
<p>ZFS d&#xF6;k&#xFC;man&#x131;nda &#x15F;u belirtilmi&#x15F;tir: <strong>Veri tekille&#x15F;tirme tablosu, ARC&apos;nin boyutunun% 25&apos;i ile s&#x131;n&#x131;rland&#x131;r&#x131;lm&#x131;&#x15F;t&#x131;r</strong>. Bu da demek ki, 1 TB depolama dizisi i&#xE7;in 3.2 GB RAM&apos;e ihtiyac&#x131;n&#x131;z olmad&#x131;&#x11F;&#x131; anlam&#x131;na gelir. Veri tekille&#x15F;tirme tablonuzun s&#x131;&#x11F;mas&#x131;n&#x131; sa&#x11F;lamak i&#xE7;in 14 GB RAM gerekir demektir. Ba&#x15F;ka bir deyi&#x15F;le, tekille&#x15F;tirme yapmay&#x131; planl&#x131;yorsan&#x131;z, RAM ayak izinizi d&#xF6;rt kat&#x131;na &#xE7;&#x131;kard&#x131;&#x11F;&#x131;n&#x131;zdan emin olun, yoksa karn&#x131;n&#x131;z bayaa a&#x11F;r&#x131;yacakt&#x131;r.</p>
<h4 id="l2arc-ile-tekille&#x15F;tirme">L2ARC ile tekille&#x15F;tirme</h4>
<p>Tekille&#x15F;tirme tablosu RAM&apos;de tutulamayacak boyuta ula&#x15F;t&#x131;&#x11F;&#x131; zaman diske kayd&#x131;r&#x131;lacakt&#x131;r demi&#x15F;tim, veriler daha yava&#x15F; olan plakal&#x131; disklere aktar&#x131;l&#x131;p tekelle&#x15F;tirmenin yava&#x15F;lamamas&#x131; ad&#x131;na tekelle&#x15F;tirmeler L2ARC disklerine ta&#x15F;&#x131;nabilir. L2ARC&apos;niz h&#x131;zl&#x131; SSD&apos;lerden veya RAM s&#xFC;r&#xFC;c&#xFC;lerinden olu&#x15F;uyorsa, her okuma ve yazma i&#x15F;leminde tekille&#x15F;tirme tablosunu, plakal&#x131; disklerde oldu&#x11F;un kadar k&#xF6;t&#xFC; etkilemeyecektir. Yine de, SSD&apos;ler RAM&apos;in sahip oldu&#x11F;u y&#xFC;ksek h&#x131;zlara sahip olmad&#x131;&#x11F;&#x131; i&#xE7;in, bunun h&#x131;z &#xFC;zerinde negatif bir etkisi olacakt&#x131;r. Bu nedenle, gece veya haftal&#x131;k yedekleme sunucular&#x131; gibi performans&#x131;n kritik olmad&#x131;&#x11F;&#x131; depolama sunucular&#x131; i&#xE7;in, L2ARC &#xFC;zerindeki tekille&#x15F;tirme tablosu mant&#x131;kl&#x131; olabilir.</p>
<h4 id="tekille&#x15F;tirmeyi-etkinle&#x15F;tirme">Tekille&#x15F;tirmeyi Etkinle&#x15F;tirme</h4>
<p>Bir veri k&#xFC;mesi i&#xE7;in tekille&#x15F;tirmeyi etkinle&#x15F;tirmek i&#xE7;in &quot;<strong><code>dedup</code></strong>&quot; &#xF6;zelli&#x11F;ini etkinle&#x15F;tirmeniz gerekmektedir.Ancak burada ayn&#x131; s&#x131;k&#x131;&#x15F;t&#x131;rma konusunda oldu&#x11F;u gibi &#x15F;&#xF6;yle bir durum vard&#x131;r. Tekille&#x15F;tirmenin aktif edilmesinden itibaren ya&#x15F;anacak veri de&#x11F;i&#x15F;imleri ve eklemeleri tekille&#x15F;tirmeye dahil olacakt&#x131;r ve tekille&#x15F;tirme yaln&#x131;zca bu veri lk&#xFC;mesine kaydedilen veriler, yinelenen bloklar i&#xE7;in kontrol edilecektir. Ayr&#x131;ca, tekille&#x15F;tirilen veriler atomik bir i&#x15F;lem olarak diske aktar&#x131;lmaz. Bunun yerine, bloklar her seferinde bir blok olacak &#x15F;ekilde diske seri olarak yaz&#x131;l&#x131;r. Bu nedenle, bloklar yaz&#x131;lmadan &#xF6;nce bir elektrik kesintisi olmas&#x131; durumunda bu veri hiyerar&#x15F;imizin patates olmas&#x131;na yol a&#xE7;abilmektedir.</p>
<p>S&#x131;k&#x131;&#x15F;t&#x131;rmada oldu&#x11F;u gibi &#x15F;imdi de tekille&#x15F;tirme i&#xE7;in <code>deneme</code> veri k&#xFC;mesini kullanal&#x131;m.</p>
<pre><code class="lang-text">~# zfs set dedup=on tank/deneme
~# cd tank/deneme/
~# ls
dosya
~# cp dosya dosya2
~# ls
dosya dosya2
~# zfs get compressratio tank/deneme
NAME         PROPERTY       VALUE  SOURCE
tank/deneme  compressratio  1.74x  -
~# zpool get dedupratio tank
NAME  PROPERTY    VALUE  SOURCE
tank  dedupratio  1.42x  -
~# ls -lh
toplam 181M
-rw-r--r--. 1 root root 98M Mar  3 13:15 dosya
-rw-r--r--. 1 root root 83M Mar  3 14:04 dosya2

# zfs list tank/deneme
NAME          USED  AVAIL  REFER  MOUNTPOINT
tank/deneme   181M  10.8G  181M   /tank/deneme
</code></pre>
<p>Bu durumda, veriler &#xF6;nce s&#x131;k&#x131;&#x15F;t&#x131;r&#x131;l&#x131;r, ard&#x131;ndan tekille&#x15F;tirilir. Ham veriler normalde yakla&#x15F;&#x131;k 100 MB disk kaplar, ancak s&#x131;k&#x131;&#x15F;t&#x131;rma ve tekille&#x15F;tirme nedeniyle yaln&#x131;zca 86 MB yer kaplar ki bu tamam&#x131; ile random olu&#x15F;turulmu&#x15F; bir dosya i&#xE7;in &#xF6;nemli bir tasarruf miktar&#x131; demektir.</p>
<h3 id="zvol">ZVol</h3>
<p>Bir ZVOL, sisteme blok cihaz olarak aktar&#x131;lan bir ZFS hiyerar&#x15F;i birimidir. &#x15E;imdiye kadar, ZFS dosya sistemi ile u&#x11F;ra&#x15F;&#x131;rken, havuzumuzu olu&#x15F;turmak d&#x131;&#x15F;&#x131;nda, hiyerar&#x15F;iler olu&#x15F;turmay&#x131; ve veri setlerini monte etmeyi g&#xF6;sterdim. Bunlar&#x131; anlat&#x131;rken blok cihazlarla hi&#xE7; ilgilenmedim.</p>
<p>ZFS, geleneksel bir dosya sisteminden daha fazlas&#x131; oldu&#x11F;unu belirtmi&#x15F;tim. ZFS disklerle ayg&#x131;tlarla ve veri bloklar&#x131; ile &#xE7;al&#x131;&#x15F;&#x131;rken daha &#xE7;ok bir kullan&#x131;c&#x131; alan&#x131; uygulamas&#x131; gibi bir kullan&#x131;m sunuyor. Bu &#x15F;u denemek, GNU/Linux&apos;ta dosya sistemleriyle &#xE7;al&#x131;&#x15F;&#x131;rken, ister tam diskler, b&#xF6;l&#xFC;mler, RAID dizileri veya mant&#x131;ksal birimler olsun, s&#xFC;rekli olarak blok ayg&#x131;tlarla &#xE7;al&#x131;&#x15F;mam&#x131;z gerekir. Bunu yaparken &#xE7;o&#x11F;unlukla neredeyse alt d&#xFC;zey baz&#x131; komutlarla u&#x11F;ra&#x15F;mam&#x131;z, sistemde de&#x11F;i&#x15F;imler yapmam&#x131;z ve hatta sa&#xE7;ma sapan zorluklara sebep verecek baz&#x131; &#x15F;eylerle bo&#x11F;u&#x15F;mam&#x131;z gerekmektedir. ZFS ise bu dizilerle neredeyse donan&#x131;m ve &#xE7;ekirdek katmanla kullan&#x131;c&#x131;y&#x131; u&#x11F;ra&#x15F;t&#x131;rmak yerine basit bir komut seti sayesinde b&#xFC;t&#xFC;n bunlar&#x131; kendisi otomatik bir &#x15F;ekilde halleder, veya neredeyse otomatik bir &#x15F;ekilde. </p>
<p>&#x15E;imdi ellerimizi ZVOL ile u&#x11F;ra&#x15F;&#x131;rken b&#xFC;t&#xFC;n bu yap&#x131;ya daha biraz geleneksel disk y&#xF6;netim sistemlerindeki gibi dalaca&#x11F;&#x131;z. ZVOL, depolama havuzunuzda bulunan bir ZFS blok cihaz&#x131;d&#x131;r. Bu cihaz sayesinde, tek bloklu ayg&#x131;t&#x131;n aynalardan veya RAID-Z ayg&#x131;tlar&#x131; gibi temel RAID dizilerinden ZVOL sayesinde yararlanabilece&#x11F;imiz ve alt d&#xFC;zeyde baz&#x131; de&#x11F;i&#x15F;imler yapabilece&#x11F;imiz anlam&#x131;na gelir.</p>
<p>ZVOL bir taraftan disk hiyerar&#x15F;isinin yararland&#x131;&#x11F;&#x131; anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;ler gibi yazma &#xFC;zerine kopyalama &#xF6;zelliklerinin avantajlar&#x131;ndan yararlan&#x131;rken bir di&#x11F;er noktada havuzlara ait &#xE7;evrimi&#xE7;i sorun temizleme, veri yay&#x131;mlama, blok s&#x131;k&#x131;&#x15F;t&#x131;rma ve veri tekille&#x15F;tirme &#xF6;zelliklerinden ve hatta havuzlara ait ZIL ve ARC gibi disk sistemlerinden de faydalan&#x131;r.</p>
<p>Me&#x15F;ru bir blok cihaz&#x131; oldu&#x11F;u i&#xE7;in, ZVOL&apos;nuzla &#xE7;ok ilgin&#xE7; &#x15F;eyler yapabilirsiniz. &#x130;lgin&#xE7; derken ciddi manada sa&#xE7;ma sapan gelebilecek &#x15F;eyleri bile yapabiliriz.</p>
<h4 id="zvol-olu&#x15F;turmak">ZVOL olu&#x15F;turmak</h4>
<p>Bir ZVOL olu&#x15F;turmak i&#xE7;in, &quot;zfs create&quot; komutumuzla &quot;-V&quot; parametresini kullan&#x131;yoruz ve ona bir boyut veriyoruz. ZVOL&apos;&#xFC;  ZFS havuzlar&#x131; alt&#x131;nda olu&#x15F;turuyoruz, hiyerar&#x15F;ilerden tek fark&#x131;m&#x131;z ZVOL olu&#x15F;tururken boyut belirlememiz gerekmektedir. &#x15E;imdi 1G boyutunda bir ZVOL olu&#x15F;tural&#x131;m:</p>
<pre><code># zfs create -V 1G tank/zvoldisk
# ls -l /dev/zvol/tank/zvoldisk
lrwxrwxrwx  2 root root   4096 &#x15E;ub  1 14:41  /dev/zvol/tank/disk1 -&gt; ../../zd145
# ls -l /dev/tank/zvoldisk
lrwxrwxrwx  2 root root   4096 &#x15E;ub  1 14:41  /dev/tank/zvoldisk -&gt; ../../zd145
</code></pre><p>ZVOL ile alakal&#x131; farketti&#x11F;imiz gibi resmen /dev dizini i&#xE7;erisinde bir ayg&#x131;t olu&#x15F;turmul gibi g&#xF6;r&#xFC;nmekteyiz, bu diskin 1 GB boyutunda oldu&#x11F;u ve %100 ger&#xE7;ek bir blok cihaz oldu&#x11F;u i&#xE7;in, ba&#x15F;ka herhangi bir blok cihazla yapaca&#x11F;&#x131;m&#x131;z her &#x15F;eyi yapabiliriz. &#x130;&#x15F;te bu esneklik sayesinde  ZFS&apos;ye m&#xFC;kemmel bir esneklik ekleme avantaj&#x131;n&#x131; elde ederiz. Ayr&#x131;ca, boyutundan ba&#x11F;&#x131;ms&#x131;z olarak bir ZVOL olu&#x15F;turmak neredeyse an&#x131;nda ger&#xE7;ekle&#x15F;ir. Neredeyse bilgisayara yeni bir disk ba&#x11F;lamaktan daha h&#x131;zl&#x131; olarak bu ger&#xE7;ekle&#x15F;tirilebilir.</p>
<p>Bu ZVOL ayg&#x131;t&#x131;n&#x131;n bir blok cihaz&#x131; oldu&#x11F;unu belirtmi&#x15F;tim. Bu ayg&#x131;t ayn&#x131; bir img gibi bir blok ayg&#x131;t&#x131; olu&#x15F;tup ba&#x11F;lamamam&#x131;z m&#xFC;mk&#xFC;n. Ayr&#x131;ca di&#x11F;er herhangi bir blok cihazda oldu&#x11F;u gibi, onu bi&#xE7;imlendirebilir, takas i&#xE7;in ve hatta ext4 format&#x131;nda disk olarak bile kullanabiliriz. 
Ama ZVOL ayg&#x131;tlar&#x131; bu kadar zarif ve geni&#x15F; &#xF6;zelliklere sahip de&#x11F;il, hatta ciddi s&#x131;n&#x131;rlamalara bile sahip.</p>
<p>&#x130;lk olarak, varsay&#x131;lan olarak ZVOL blok cihazlar&#x131;n&#x131;z i&#xE7;in her bir havuz i&#xE7;in yaln&#x131;zca 8 cihaz olu&#x15F;turabilme hakk&#x131;m&#x131;z vard&#x131;r. Ancak bu miktar&#x131; havuz &#xFC;zerinden de&#x11F;i&#x15F;tirebiliriz. ZFS ile varsay&#x131;lan olarak maksimum 2^64 ZVOL ayg&#x131;t&#x131; olu&#x15F;turabiliriz. Ayr&#x131;ca, dosya sisteminizin &#xFC;st&#xFC;nde &#xF6;nceden tahsis edilmi&#x15F; bir imaj gerektirir. Yani, ZFS sayesinde &#xFC;&#xE7; veri katman&#x131;n&#x131; y&#xF6;netebiliyoryz: blok ayg&#x131;t&#x131;, dosya ve dosya sistemindeki bloklar. ZVOL&apos;larla, blok cihaz&#x131;, t&#x131;pk&#x131; di&#x11F;er veri k&#xFC;meleri gibi y&#xF6;netim yapabilir, ve bu cihazlardan yararlanarak verilerimizi depolama havuzunun hemen d&#x131;&#x15F;&#x131;na aktarabiliriz.</p>
<p>Bu ZVOL ile yapabilece&#x11F;imiz baz&#x131; &#x15F;eylere bakal&#x131;m.</p>
<h4 id="zvolde-ext4">ZVOL&apos;de Ext4</h4>
<p>Bu kula&#x11F;a tuhaf gelebilir, ancak ZVOL aynen bir donan&#x131;m ayg&#x131;t&#x131; gibidir, ba&#x15F;ka bir dosya sistemini ZVOL&apos;&#xFC; bi&#xE7;imlendirmek i&#xE7;in kullanabilir ve onu bir ZVOL&apos;un &#xFC;zerine ba&#x11F;layabilirsiniz. Di&#x11F;er bir deyi&#x15F;le, ext4 formatl&#x131; bir ZVOL olu&#x15F;turup ve bunu /mnt&apos;ye ba&#x11F;layabiliriz. Hatta ZVOL&apos;u alt b&#xF6;l&#xFC;mlere ay&#x131;rabilir ve &#xFC;zerine birden &#xE7;ok dosya sistemi koyabiliriz. Hadi bunu yapal&#x131;m!</p>
<pre><code>~# zfs create -V 100G tank/ext4
~# fdisk /dev/tank/ext4
( follow the prompts to create 2 partitions- the first 1 GB in size, the second to fill the rest )
~# fdisk -l /dev/tank/ext4

Disk /dev/tank/ext4: 107.4 GB, 107374182400 bytes
16 heads, 63 sectors/track, 208050 cylinders, total 209715200 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 8192 bytes
I/O size (minimum/optimal): 8192 bytes / 8192 bytes
Disk identifier: 0x000a0d54

          Device Boot      Start         End      Blocks   Id  System
/dev/tank/ext4p1            2048     2099199     1048576   83  Linux
/dev/tank/ext4p2         2099200   209715199   103808000   83  Linux
~# ls -l /dev/tank/ext4p1 
lrwxrwxrwx  2 root root   4096 &#x15E;ub  1 14:41  /dev/tank/ext4p1 -&gt; ../../zd0p1
~# ls -l /dev/tank/ext4p2
lrwxrwxrwx  2 root root   4096 &#x15E;ub  1 14:41  /dev/tank/ext4p2 -&gt; ../../zd0p2
</code></pre><p>ZFS 2 ZVOL ayg&#x131;t&#x131;m&#x131;z&#x131; /dev/zd0p1 ve /dev/zd0p2 olarak linklemi&#x15F; oldu. Bunlar&#x131; bi&#xE7;imlendirelim.</p>
<pre><code>~# mkfs.ext4 /dev/zd0p1
~# mkfs.ext4 /dev/zd0p2
~# mkdir /mnt/zd0p{1,2}
~# mount /dev/zd0p1 /mnt/zd0p1
~# mount /dev/zd0p2 /mnt/zd0p2
</code></pre><p>G&#xF6;rd&#xFC;&#x11F;&#xFC;m&#xFC;z gibi  diskler olu&#x15F;turup bunlar&#x131; ba&#x11F;lam&#x131;&#x15F; olduk ama bu ne i&#x15F;imize yarad&#x131;. Mesela ZFS&apos;nin anl&#x131;k g&#xF6;r&#xFC;nt&#xFC; olu&#x15F;turma &#xF6;zelli&#x11F;ini ext4 ile kullanabiliriz.</p>
<pre><code>~# zfs snapshot tank/ext4@001
</code></pre><p>ext4&apos;&#xFC;n normalde size veremeyece&#x11F;i &#x15F;eylere ve ZFS&apos;nin t&#xFC;m avantajlar&#x131;na ZVOL sayesinde sahibiz. Bu senaryoda, art&#x131;k d&#xFC;zenli olarak verilerinizin anl&#x131;k g&#xF6;r&#xFC;nt&#xFC;s&#xFC;n&#xFC; al&#x131;yorsunuz, &#xE7;evrimi&#xE7;i f&#x131;r&#xE7;alamalar ger&#xE7;ekle&#x15F;tiriyor ve yedekleme i&#xE7;in i&#x15F; yeri d&#x131;&#x15F;&#x131;na g&#xF6;nderiyorsunuz. En &#xF6;nemlisi, verileriniz olduk&#xE7;a tutarl&#x131; bir &#x15F;ekilde korunabiliyor ve ek bir diske gerek kalmadan yedeklemeler ve geriye d&#xF6;n&#xFC;k imajland&#x131;rma i&#x15F;lemleri yap&#x131;labiliyor.</p>
<h3 id="iscsi-nfs-ve-samba-ile-disk-hiyerar&#x15F;isi-payla&#x15F;&#x131;m&#x131;">iSCSI, NFS ve Samba ile Disk Hiyerar&#x15F;isi Payla&#x15F;&#x131;m&#x131;</h3>
<p>ZFS dosya hiyerar&#x15F;ileri a&#x11F; &#xFC;zerinden ayn&#x131; bir dosya payla&#x15F;&#x131;m sisteminde oldu&#x11F;u gibi payla&#x15F;&#x131;lmaktad&#x131;r. ZFS hiyerar&#x15F;ileri, &#xF6;rne&#x11F;in NFS gibi bir dosya payla&#x15F;&#x131;m sunucusu arac&#x131;l&#x131;&#x11F;&#x131;yla belirli bir veri k&#xFC;mesini payla&#x15F;abilirsiniz. Ancak, veri k&#xFC;mesini ba&#x11F;lamazsak, bu durumda d&#x131;&#x15F;a aktarma uygulama taraf&#x131;ndan kullan&#x131;lamaz ve NFS istemcisi engellenir.</p>
<p>A&#x11F; payla&#x15F;&#x131;m&#x131; ZFS dosya sisteminin do&#x11F;as&#x131;nda oldu&#x11F;undan, veri tutars&#x131;zl&#x131;klar&#x131; i&#xE7;in endi&#x15F;e etmemize veya herhangi bir i&#x15F;lem yapmam&#x131;za gerek yoktur. ZFS&apos;nin sa&#x11F;lad&#x131;&#x11F;&#x131; b&#xFC;t&#xFC;n veri koruma yap&#x131;lar&#x131; ve sistemleri payla&#x15F;&#x131;lm&#x131;&#x15F; hiyerar&#x15F;iler i&#xE7;in de uygulanmaktad&#x131;r.</p>
<p>Veri payla&#x15F;&#x131;m&#x131;na genel bak&#x131;&#x15F;&#x131;m &#x15F;u. Ek bir kurulum yapmadan adeta dosya y&#xF6;neticisinde dola&#x15F;&#x131;r gibi ba&#x15F;ka bir bilgisayar arac&#x131;l&#x131;&#x11F;&#x131; ile dosyalar&#x131;m&#x131;za eri&#x15F;ebilir ve bunlar&#x131; d&#xFC;zenleyebiliriz.Ancak her hal&#xFC;karda, payla&#x15F;&#x131;m&#x131; sa&#x11F;lamak i&#xE7;in gerekli daemonlar&#x131; kurman&#x131;z gerekir. &#xD6;rne&#x11F;in, bir veri k&#xFC;mesini NFS arac&#x131;l&#x131;&#x11F;&#x131;yla payla&#x15F;mak istiyorsan&#x131;z, NFS sunucusunu y&#xFC;klememiz ve &#xE7;al&#x131;&#x15F;t&#x131;rmam&#x131;z gerekir. Ard&#x131;ndan, yapman&#x131;z gereken tek &#x15F;ey, veri k&#xFC;mesindeki payla&#x15F;&#x131;m NFS anahtar&#x131;n&#x131; aktifle&#x15F;tirmektir ve bu i&#x15F;lemin hemen ard&#x131;ndan hiyerar&#x15F;imiz kullan&#x131;labilir olacakt&#x131;r.</p>
<h4 id="nfs-arac&#x131;l&#x131;&#x11F;&#x131;yla-payla&#x15F;ma">NFS arac&#x131;l&#x131;&#x11F;&#x131;yla payla&#x15F;ma</h4>
<p>Bir veri k&#xFC;mesini NFS arac&#x131;l&#x131;&#x11F;&#x131;yla payla&#x15F;mak i&#xE7;in, &#xF6;nce NFS sunucusunu a&#xE7;mam&#x131;z gerekmektedir. Debian ve Ubuntu&apos;da NFS sunucusu &quot;nfs-kernel-server&quot; paketi taraf&#x131;ndan sa&#x11F;lanmaktad&#x131;r. Ayr&#x131;ca, Debian ve Ubuntu ile, <code>/etc/export</code> dosyas&#x131;nda bir d&#x131;&#x15F;a aktar&#x131;m talimatnamesi olmad&#x131;&#x11F;&#x131; s&#xFC;rece NFS arka plan program&#x131; ba&#x15F;lamayacakt&#x131;r. 
Bu nedenle payla&#x15F;&#x131;ma ba&#x15F;lamak i&#xE7;in, yaln&#x131;zca localhost taraf&#x131;ndan kullan&#x131;labilen sahte bir d&#x131;&#x15F;a aktarma olu&#x15F;turabilir veya ba&#x15F;lang&#x131;&#xE7; &#x200B;&#x200B;komut dosyas&#x131;n&#x131; ge&#xE7;erli bir d&#x131;&#x15F;a aktarmay&#x131; engellemeyecek &#x15F;ekilde d&#xFC;zenleyebiliriz.</p>
<p>Bir di&#x11F;er yandan OpenSUSE, Fedora, RHEL ve CentOS i&#xE7;in <code>nfs-utils</code> paketi nfs payla&#x15F;&#x131;m&#x131; i&#xE7;in kullan&#x131;lacakt&#x131;r. Yine ayn&#x131; &#x15F;ekilde <code>firewalld</code> &#xFC;zerinden portlar&#x131; aktifle&#x15F;tirmemiz gerekmektedir.</p>
<p>Gerekli paketleri kurmam&#x131;z&#x131;n ard&#x131;ndan NFS sunucumuzu ba&#x15F;latal&#x131;m:</p>
<pre><code>~# service nfs start
</code></pre><p>&#x15E;imdi de ip adresimize bakal&#x131;m</p>
<pre><code>~# ifconfig

enp2s0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500
        ether c8:d9:d2:eb:e9:d7  txqueuelen 1000  (Ethernet)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 31570  bytes 10961690 (10.4 MiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 31570  bytes 10961690 (10.4 MiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

wlo1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
        inet 192.168.1.123  netmask 255.255.255.0  broadcast 192.168.1.255
        inet6 fe80::3eb2:86f:1c57:47c4  prefixlen 64  scopeid 0x20&lt;link&gt;
        ether 74:40:bb:e0:e3:db  txqueuelen 1000  (Ethernet)
        RX packets 174848  bytes 291792813 (278.2 MiB)
        RX errors 0  dropped 4118  overruns 0  frame 0
        TX packets 121922  bytes 29077165 (27.7 MiB)
        TX errors 0  dropped 3 overruns 0  carrier 0  collisions 0
</code></pre><p>Ve art&#x131;k haz&#x131;r&#x131;z, ZFS veri k&#xFC;mesini payla&#x15F;al&#x131;m</p>
<pre><code>~# zfs set sharenfs=&quot;rw=@192.168.1.123/24&quot; tank/srv
~# zfs share tank/srv
</code></pre><h4 id="samba-arac&#x131;l&#x131;&#x11F;&#x131;yla-payla&#x15F;ma">Samba arac&#x131;l&#x131;&#x11F;&#x131;yla payla&#x15F;ma</h4>
<p>NFS&apos;de oldu&#x11F;u gibi, SMB/CIFS arac&#x131;l&#x131;&#x11F;&#x131;yla bir ZFS veri k&#xFC;mesini payla&#x15F;mak i&#xE7;in, arka plan sunucusunun kurulu ve &#xE7;al&#x131;&#x15F;&#x131;yor olmas&#x131; gerekir. SMB 2.1 dosya payla&#x15F;&#x131;m deste&#x11F;i, k&#xFC;melenmi&#x15F; dosya sunucular&#x131; ve &#xE7;ok daha fazlas&#x131;n&#x131; verimektedir. Samba 4 deste&#x11F;i ile beraber disk &#xFC;zerinde NFS&apos;den daha fazlas&#x131;n&#x131; daha esnek&#xE7;e yapabilece&#x11F;imiz bir yap&#x131;ya sahibiz.</p>
<pre><code>~# zfs set sharesmb=on tank/srv
~# zfs share tank/srv
</code></pre><h4 id="iscsi-arac&#x131;l&#x131;&#x11F;&#x131;-ile-payla&#x15F;ma">iSCSI arac&#x131;l&#x131;&#x11F;&#x131; ile payla&#x15F;ma</h4>
<p>SMB ve NFS&apos;de oldu&#x11F;u gibi, iSCSI arka plan program&#x131;n&#x131;n kurulu ve &#xE7;al&#x131;&#x15F;&#x131;yor olmas&#x131; gerekir.</p>
<pre><code>~# zfs set shareiscsi=on tank/srv
</code></pre>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="zfs-hiyerarshisi.html" class="navigation navigation-prev " aria-label="Previous page: ZFS Disk Hiyerarşisi">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../zfsde-ek-oezellikler/zfs-havuz-yoenetimi-bazi-ek-oezellikler.html" class="navigation navigation-next " aria-label="Next page: ZFS Havuz Yönetimi - Bazı Ek Havuz Yönetimi Komutları">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"description":"ZFS'de üst düzey olarak nitelendirilebilecek hiyerarşi komutları.","title":"ZFS Üst Düzey Disk Hiyerarşi Komutları","level":"5.2","depth":1,"next":{"title":"ZFS Havuz Yönetimi - Bazı Ek Havuz Yönetimi Komutları","level":"6.1","depth":1,"path":"zfsde-ek-oezellikler/zfs-havuz-yoenetimi-bazi-ek-oezellikler.md","ref":"zfsde-ek-oezellikler/zfs-havuz-yoenetimi-bazi-ek-oezellikler.md","articles":[]},"previous":{"title":"ZFS Disk Hiyerarşisi","level":"5.1","depth":1,"path":"zfs-dosya-hiyerarsisi/zfs-hiyerarshisi.md","ref":"zfs-dosya-hiyerarsisi/zfs-hiyerarshisi.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["livereload"],"pluginsConfig":{"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"zfs-dosya-hiyerarsisi/zfs-uest-duezey-disk-hiyerarsi-komutlari.md","mtime":"2021-03-04T20:48:49.286Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-03-04T20:51:51.531Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

